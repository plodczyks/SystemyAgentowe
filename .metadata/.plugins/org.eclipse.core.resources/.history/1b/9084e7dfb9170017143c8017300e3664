import jade.core.*;
import jade.core.behaviours.*;
//import jade.core.messaging.*;
import jade.lang.acl.*;

public class SAAgent extends Agent {

	private static final long serialVersionUID = 1L;
	
//	private AID emaTopic;
//	private AID saTopic;
//	
//	private MessageTemplate emaTemplate;
	
	private int mcaCount;
	
	private int messageSize;
	private int messageCount;
	private String messageContent;
//	private AID spamTopic;
	
	protected void setup(){
		
		Object[] args=getArguments();
		mcaCount=Integer.parseInt((String)(args[0]));
		messageCount= Integer.parseInt((String)(args[1]));
		messageSize= Integer.parseInt((String)(args[2]));

		StringBuilder sb=new StringBuilder();
		for(int i=0;i<messageSize;i++){
			sb.append('A');			
		}
		messageContent=sb.toString();

//		try {
//			TopicManagementHelper topicHelper = (TopicManagementHelper)getHelper(TopicManagementHelper.SERVICE_NAME);
//			emaTopic = topicHelper.createTopic("EMA");
//			topicHelper.register(emaTopic);
//			emaTemplate = MessageTemplate.MatchTopic(emaTopic);
//			
//			saTopic=topicHelper.createTopic("SA");
//		} catch (ServiceException e) {
//			// TODO Auto-generated catch block
//			e.printStackTrace();
//		}
		
		addBehaviour(new CyclicBehaviour(this) {

			private static final long serialVersionUID = 1L;

			@Override
			public void action() {
				ACLMessage rcv = receive();//emaTemplate);
				if(rcv !=null) {
					System.out.println(getAID().getName() +": Spamming is starting. ");
					for(int i=0;i<messageCount;i++){
						for(int j=1;j<=mcaCount;j++){
							ACLMessage msg = new ACLMessage(ACLMessage.INFORM);
							msg.setContent(messageContent);
							msg.addReceiver(new AID("MessageConsumingAgent"+j,AID.ISLOCALNAME));
							System.out.println(getAID().getName() +": Spam message to MessageConsumingAgent"+i+" was sended.");
							send(msg);
						}
					}
					removeBehaviour(this);					
				}
				else {
					block();
				}
			}
		});
	}
	
	protected void takeDown(){
		super.takeDown();
	}
}
